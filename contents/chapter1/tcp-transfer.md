#TCP传输优化实践

TCP传输阶段优化的优化目标主要是提高网络的吞吐量，我们可以通过调整TCP套接字读写缓冲区、升级拥塞控制算法等提高传输性能。

每个套接字都有一个读写缓冲区

- 读缓冲区，缓存了远端发过来的数据。如果读缓冲区已满，就不能再接收新的数据
- 写缓冲区，缓存了要发出去的数据。如果写缓冲区已满，应用程序的写操作就会被阻塞

|套接字优化方向|内核参数| 参考设置 |
|:---|:---|:---|
|增大每个套接字缓冲区大小| net.core.optmem_max| 81920|
|增大套接字接收缓冲区大小| net.core.rmem_max| 513920|
|增大套接字发送缓冲区大小| net.core.wmem_max| 513920|
|增大TCP接收缓冲区范围| net.ipv4.tcp_rmem| 4096 87380 16777216|
|增大TCP发送缓冲区范围| net.ipv4.tcp_wmem| 4096 65536 16777216|
|增大UDP缓冲缓冲区范围| et.ipv4.udp_mem| 188562 251416 377124|

几个参数的解释：

- tcp_rmem 和 tcp_wmem 的三个数值分别是 min，default，max，系统会根据这些设置，自动调整 TCP 接收 / 发送缓冲区的大小。
- udp_mem 的三个数值分别是 min，pressure，max，系统会根据这些设置，自动调整 UDP 发送缓冲区的大小。

表格中的数值只提供参考价值，具体应该设置多少还需要根据实际的网络状况来确定。比如发送缓冲区大小理想数值是: 吞吐量 * 延迟，这样才可以达到最大网络利用率。