# 1.1 为什么要上云？

上云有两个解释，狭义的解释是：原有基于私有数据中心业务迁移到云商的平台中。相比于传统机房，云有更多的应用封装，云上服务器、云存储、云数据库... 云把 IaaS 层封装起来，让基础设施运维成本更低。广义的解释是：充分利用云计算弹性、敏捷、资源池和服务化等特性，解决业务在开发、运行整个生命周期中遇到的问题。

技术的发展很大程度都是因为业务规模、复杂度而演进的，也就是说技术升级核心动力是业务需要。在引入一项新的技术或者架构升级之前，很重要的一项工作就是明确它的目的性和计算收益。

从基础架构部门推进技术改革的角度来看，很重要的三个目的就是：降低 IT 资源成本、提高运维效率以及架构系统标准化。

## 1.1.1 降低 IT 资源成本

在以 KVM（Kernel-based Virtual Machine，基于内核的虚拟机）架构体系中，一台物理机一般支持 10 ~ 20 个 KVM，考虑业务负载情况并不均衡，尤其是业务具有波峰低谷的情况，服务器的利用率是不饱和。从表 1-1 看，高峰 CPU 利用率不到 6%，资源利用率很难达到有效使用水平。

表 1-1 某业务资源利用率概况

| 业务 | CPU | 内存| 磁盘 |
|:--|:--|:--|:--|
| 应用系统 | 6% | 53% | 20% |
| 数据库| 3% |  60% |  34% |
| 大数据| 17% |  70% |  64% |

如果升级到 Kubernetes 之后，一台 Node（物理机）可以支持 100 + Pod 运行，使用率提升 7 ~ 8 倍，相当于节省了 60% 的服务器资源。更进一步地讲，例如，离线计算型业务通常在凌晨执行，而此时刻，业务处于低谷阶段，如利用弹性计算对这部分冗余资源进行回收，供非实时计算业务使用，充分复用集群算力，将节省更多服务器资源。

## 1.1.2 提高运维效率

上云的另一个收益是提高工程效率，解放生产力。

例如，线上服务遇到突发故障时，效率最高的措施是快速构建一个相同服务的副本替代原本故障的服务，在传统的架构模式下，新构建一个服务需要环境准备、服务编译、重新部署等前置工作，这至少需要半个小时，很多时候业务高峰流量已过，副本还没有搭建完毕。而在云原生架构模式下，借助 Kubernetes 管理能力以及 GitOps 体系等，新拉起一组同样的服务（Pod）到生成环境，最快只需要几分钟（相关实践请参阅本书第十章 GitOps 相关内容）。

## 1.1.3 系统标准化

标准化的改进包括基础设施标准化，发布部署标准化，服务治理标准化等。

- 基础设施不可变及 IaC 标准化：在大规模应用的服务环境下，应用不断地更新迭代，另外基础架构本身也不断地使用、扩展和移除，云原生架构引入不可变基础设施理念，对应用开发所依靠的环境进行标准化后，DevOps 就能够启动、拆解和扩展基础设施，以响应不断波动的需求，这样的敏捷性能够造就更快、更简单的软件开发、测试和部署。

- 发布部署标准化：云原生架构下的 CI/CD 流程产品化，通过规范分支管理 Aone Flow、环境标准（测试、开发、生产）等，避免了传统架构下分支混乱、环境不一致、上线流程复杂等问题。

- 服务治理标准化 ：在传统架构模式下，每个业务团队对于服务治理都要投入一定的人力和资源成本。并且一个企业内不同团队的技术栈以及业务中的超时机制、限流机制、熔断策略等标准参差不齐，云原生架构下服务网格的出现，使得基础架构人员可以对这部工作收拢，各个业务接入 ServiceMesh 产品后服务治理方面就变得轻量且统一。