# 1.2 为什么要升级到云原生架构？

在引入一项新的技术或者架构升级之前，很重要的一项工作就是明确它的目的性和收益计算。从企业层面收益角度来看，升级云原生架构三个明确目的：降低 IT 资源成本（省钱）、提高运维效率（提高人效）以及架构系统标准化。

## 1.2.1 降低 IT 资源成本

以 KVM（Kernel-based Virtual Machine，基于内核的虚拟机）为基础的架构体系中，一台物理机一般支持 10 ~ 20 个 KVM，考虑业务负载情况并不均衡，尤其是内容型业务具有波峰低谷。笔者对某一业务进行分析，从表 1-1 看，高峰 CPU 利用率不到 6%，服务器利用率并不饱和，资源利用率很难达到有效使用水平。

表 1-1 某业务资源利用率概况

| 业务 | CPU | 内存| 磁盘 |
|:--|:--|:--|:--|
| 应用系统 | 6% | 53% | 20% |
| 数据库| 3% |  60% |  34% |
| 大数据| 17% |  70% |  64% |

如果升级到 Kubernetes，一台 Node（物理机）可以支持 100 + Pod 运行，使用率提升 7 ~ 8 倍，相当于节省了 60% 的服务器资源。

更进一步对系统进行优化。可以继续推进系统算力错峰复用能力。例如，离线计算型业务通常在凌晨执行，而此时刻，业务处于低谷阶段，如利用弹性计算对这部分冗余资源进行回收，供非实时计算业务使用，充分复用集群算力，将节省更多服务器资源。

以笔者对某一业务资源进行核算结果为例，如果将传统 KVM 架构升级为弹性伸缩的容器架构，且利用率提升到 30%+，理论可减少 50% 以上的财务支出。

## 1.2.2 提高运维效率

云原生架构另一个较明显收益是提高工程效率，解放生产力。

例如，线上服务遇到突发故障时，效率最高的措施是快速构建一个相同服务的副本替代原本故障的服务。

在传统的架构模式下，新构建一个服务需要环境准备、服务编译、重新部署等前置工作，这至少需要半个小时，很多时候业务高峰流量已过，副本还没有搭建完毕。而在云原生架构模式下，借助 Kubernetes 管理能力以及 CI/CD 体系等，新拉起一组同样的服务到生成环境，最快只需要几分钟（相关实践请参阅本书第十章 GitOps 内容）。

## 1.2.3 系统标准化

系统标准化改进包括基础设施标准化，发布部署标准化，服务治理标准化等。

- **基础设施不可变及 IaC 标准化**：在大规模应用的服务环境下，应用不断地更新迭代，另外基础架构本身也不断地使用、扩展和移除，云原生架构引入不可变基础设施理念，对应用开发所依靠的环境进行标准化后，DevOps 就能够启动、拆解和扩展基础设施，以响应不断波动的需求，这样的敏捷性能够造就更快、更简单的软件开发、测试和部署。

- **发布部署标准化**：云原生架构下的 CI/CD 流程产品化，通过规范分支管理 Aone Flow、环境标准（测试、开发、生产）等，避免了传统架构下分支混乱、环境不一致、上线流程复杂等问题。

- **服务治理标准化**：在传统架构模式下，每个业务团队对于服务治理都要投入一定的人力和资源成本。并且一个企业内不同团队的技术栈以及业务中的超时机制、限流机制、熔断策略等标准参差不齐，云原生架构下服务网格的出现，使得基础架构人员可以对这部工作收拢，各个业务接入 ServiceMesh 产品后服务治理方面就变得轻量且统一。