# 3.2.1 使用 HTTPDNS 服务解决 DNS 解析问题

本节我们探讨移动端应用在传统域名解析存在的一些问题：

- **延迟问题** 如无缓存，DNS 解析需要递归遍历多次才能获取解析结果。这无疑增加了网络请求前置延时，特别是在移动互联网环境下，弱网环境 RTT 可能高达数百毫秒。
- **域名劫持** 部分地区的 Local DNS 存在域名劫持、污染的问题。而这些问题往往间歇性、局部性发生，没有明显的规律，导致开发者很难对其进行量化、评估、预防。
- **调度不精准** 部分 Local DNS 服务商为降低运营成本，会将解析请求转发给其他 Local DNS，这会影响域名解析的精准性并对用户业务访问延迟带来影响。

传统域名解析面临的诸多问题与挑战本质根源在于 Local DNS 服务质量不可控，如果有一个更安全、稳定、高效 DNS 解析 服务，上述问题看起来就可以彻底地得到解决，HTTPDNS 服务在这样的背景下应运而生。

## 1. HTTPDNS 是什么？

HTTPDNS 即使用安全的 HTTP(S) 协议运行 DNS，面向多端应用（移动端APP，PC客户端应用）。HTTPDNS 的原理是使用 HTTP(S) 协议绕过运营商的 Local DNS，避免域名劫持，也更准确地判断客户端地区和运营商，得到更精准的解析结果。

<div  align="center">
	<img src="../assets/httpdns.png" width = "520"  align=center />
	<p>图：HTTPDNS 模式下 DNS 解析流程</p>
</div>

总结使用 HTTPDNS 进行域名解析有点，如下：

- 防劫持：使用 HTTPS协议进行域名解析，域名解析请求直接发送至 HTTPDNS 服务器，绕过运营商 Local DNS，避免域名劫持问题。
- 精准调度：由于运营商策略的多样性，其 Local DNS 的解析结果可能不是最近、最优的节点，HTTPDNS 能直接获取客户端 IP ，基于客户端 IP 获得最精准的解析结果，让客户端就近接入业务节点。


使用 HTTPDNS 配合客户端策略（预解析、懒加载等），可以实现低解析延迟的域名解析效果。在我们的实践观察中，移动端产品启用 HTTPDNS 服务，初次请求延迟约下降 25% 左右，之前各类的劫持、页面无法打开报障也大幅下降。