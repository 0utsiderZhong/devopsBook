# 2.3.4 使用 HTTPDNS

解决Authoritative nameserver的问题之后，我们再回过头看看DNS解析器（也就是LocalDNS）的问题。

## 1.传统DNS存在的问题

当我们发出请求解析 DNS 的时候，首先，会先连接到运营商本地的 DNS 服务器，由这个服务器帮我们去整棵 DNS 树上进行解析，然后将解析的结果返回给客户端。但是本地的 DNS 服务器，作为一个本地导游，往往有自己的“小心思”。

一个最令人头痛的问题，相信每个人都遇到，就是域名劫持。其他还存在延迟、调度不精准等问题。传统域名解析面临的诸多问题与挑战本质根源在于 Local DNS 服务质量不可控，如果有一个更安全、稳定、高效的DNS解析服务，上述问题看起来就可以彻底地得到解决。

HTTPDNS 服务在这样的背景下应运而生。

## 2.使用HTTPDNS改善DNS解析

简而言之，HTTPDNS 就是使用 HTTP 协议向 DNS 服务器进行请求，从而获取 IP 地址，简化了请求的复杂性。在请求 DNS 服务器的时候，使用 IP 直接访问。跳过使用系统解析的过程，自己来做 DNS 解析系统。

<div  align="center">
	<img src="../assets/httpdns.png" width = "520"  align=center />
	<p>图 3-3 HTTPDNS 模式下 DNS 解析流程</p>
</div>

HTTPDNS使用 HTTP(S) 协议绕过运营商的 Local DNS，避免域名劫持、也更准确地判断客户端地区和运营商，得到更精准的解析结果。

总结使用 HTTPDNS 进行域名解析优点，如下：

- 防劫持：使用HTTPS协议进行域名解析，域名解析请求直接发送至 HTTPDNS 服务器，绕过运营商 Local DNS，避免域名劫持问题。
- 精准调度：由于运营商策略的多样性，其 Local DNS 的解析结果可能不是最近、最优的节点，HTTPDNS 能直接获取客户端 IP ，基于客户端 IP 获得最精准的解析结果，让客户端就近接入业务节点。

使用 HTTPDNS 配合客户端策略（预解析、懒加载等），可以实现低解析延迟的域名解析效果。在我们的实践观察中，移动端产品启用 HTTPDNS 服务，初次请求延迟约下降 25% 左右，之前各类的劫持、页面无法打开报障也大幅下降。