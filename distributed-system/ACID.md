# 7.1 事务

事务（Transaction）是一段特殊的执行程序，它存在的意义就是保证系统中不同数据间不会产生矛盾，数据修改后的结果是我们期望的，也就是保证数据状态的一致性（Consistency）。想要达成数据状态的一致性，需要三个方面的努力：

- **原子性（Atomic）**：在一组操作中，要么全部操作执行成功，要么全部执行失败，不存在中间数据，也不存在部分操作成功部分操作失败的情况。在执行事务的过程中，如果某一个操作失败，那么整个事务都将回滚（Rollback），恢复至事务开始的状态。
- **隔离性（Isolation）**：多个事务在执行期间，事务与事务之间互不影响。
- **持久性（Durability）**：事务执行成功后，所有的操作都是永久的，哪怕服务器发生故障。

这也就是常说的事务的 **ACID 特性**，不过笔者这里额外提一点，事实上 ACID 这四种特性并不正交，A、I、D 是手段，C（Consistency）是三者协作的目标，弄到一块完全是为了读起来顺口。


当事务的影响范围局限在一个关系型数据库范围内，很多时候上述四个特性实现起来水到渠成，但倘若事务涉及修改的对象跨节点、跨越网络时，这个问题就开始变得复杂且有趣。

事务的概念虽然最初起源于数据库系统，但今天已经不再局限于数据库本身了，所有需要保证数据一致性的应用场景，包括但不限于数据库、事务内存、缓存、消息队列、分布式存储等等，都有可能会用到事务。


外部一致性问题通常很难再使用 A、I、D 来解决，但是外部一致性又是分布式系统中必然会遇到且必须要解决的问题，为此我们要转变观念，将一致性从“是或否”的二元属性转变为可以按不同强度分开讨论的多元属性，在确保代价可承受的前提下获得强度尽可能高的一致性保障，也正因如此，事务处理才从一个具体操作上的“编程问题”上升成一个需要全局权衡的“架构问题”。